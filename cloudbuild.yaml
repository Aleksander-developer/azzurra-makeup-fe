# cloudbuild.yaml per il servizio Frontend (repository separata)

steps:
# 1. FRONTEND: Deploy su Cloud Run usando Buildpacks
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  id: 'deploy-frontend'
  entrypoint: gcloud
  args:
    - 'run'
    - 'deploy'
    - 'azzurra-frontend' # Nome servizio Cloud Run
    - '--source' # <-- QUESTO È IL FLAG CRUCIALE PER USARE I BUILDPACKS
    - '.' # Contesto sorgente: la root di questa repo (dove package.json è)
    - '--platform'
    - 'managed'
    - '--region'
    - 'europe-west1'
    - '--allow-unauthenticated'
    - '--port'
    - '8080'
    - '--timeout'
    - '900s' # Timeout esteso per SSR
    - '--project'
    - '${PROJECT_ID}'
    # Variabili d'ambiente per Buildpacks: indicano quali script eseguire
  env:
    - 'GOOGLE_NODE_RUN_SCRIPTS=build:ssr,serve:ssr' # Esegui 'build:ssr' poi 'serve:ssr'